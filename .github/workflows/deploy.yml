name: Deploy to Production

on:
  workflow_dispatch:   # para testares manualmente
  push:
	  branches: ["master"]   # adapta se for main

permissions:
  id-token: write
  contents: read

jobs:
  build:
	  name: Build
	  runs-on: ubuntu-latest
	  steps:
  	  - uses: actions/checkout@v4

  	  - name: Setup .NET
    	  uses: actions/setup-dotnet@v4
    	  with:
      	  dotnet-version: "8.0.x"

  	  - name: Restore
    	  run: dotnet restore App/App.csproj

  	  - name: Build
    	  run: dotnet build App/App.csproj --no-restore -c Release

  deploy:
	  name: Deploy to Production
	  needs: build
	  runs-on: ubuntu-latest

	# üåü Ambiente com aprova√ß√£o obrigat√≥ria (deploy gate)
	  environment:
  	  name: production
  	  url: https://example.com/myapp   # opcional

	  steps:
  	  - uses: actions/checkout@v4

  	  - name: Setup .NET
    	  uses: actions/setup-dotnet@v4
    	  with:
      	  dotnet-version: "8.0.x"

  	  - name: Use environment secret
    	  run: |
      	  echo "Liga√ß√£o (parcial): ${MY_CONN:0:10}..."
    	  env:
      	  MY_CONN: ${{ secrets.MY_CONN }}

  	  - name: Fake deploy (demo)
    	  run: |
          echo "Simula√ß√£o de deploy com liga√ß√£o:"
          echo $MY_CONN
      	echo "Simula√ß√£o de deploy com liga√ß√£o:"
      	echo $MY_CONN

