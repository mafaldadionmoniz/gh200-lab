name: Testar Ação Local (fixada a SHA)

on:
  workflow_dispatch:

jobs:
  executar-acao:
    runs-on: ubuntu-latest

    steps:
      # Checkout "normal" do repo na ref do evento (branch/PR/tag atual)
      - name: Checkout do repositório (padrão)
        uses: actions/checkout@v4

      # Checkout "fixado" apenas da pasta da ação noutra diretoria, usando a SHA da tag
      - name: Checkout da AÇÃO fixada à SHA
        uses: actions/checkout@v4
        with:
          # O próprio repositório atual
          repository: ${{ github.repository }}
          # <-- coloca aqui a SHA que extraíste da tua tag v1.0.0
          ref: 0571b12cec91c67f2410ca5d5d50c282680b980a
          # Faz checkout para uma subpasta separada
          path: pinned_action
          # traz o histórico completo (evita refs “rasas”)
          fetch-depth: 0

      - name: Listar pasta da action (fixada)
        run: |
          ls -la pinned_action/.github/actions/hello-world || true

      - name: Mostrar primeiras linhas do action.yml
        run: |
          sed -n '1,120p' pinned_action/.github/actions/hello-world/action.yml

      # (Opcional) Verifica rapidamente que o action.yml está legível
      - name: Verificar action.yml fixado
        run: |
          echo "::group::Conteúdo do action.yml (SHA fixada)"
          sed -n '1,120p' pinned_action/.github/actions/hello-world/action.yml
          echo "::endgroup::"

      # Executa a AÇÃO a partir da pasta fixada
      - name: Executar a ação local (fixada)
        uses: ./pinned_action/.github/actions/hello-world/
        with:
          nome_utilizador: "Mafalda"
